<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admission Form | Suraj English Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  font-family:Poppins,sans-serif;
  background:#f5f7fa;
}
.hidden{display:none}
.container{
  max-width:420px;
  margin:60px auto;
  padding:30px 20px;
  background:#fff;
  border-radius:18px;
  box-shadow:0 20px 45px rgba(0,0,0,.1);
  text-align:center;
}
input,select,button{
  width:100%;
  padding:14px;
  margin-bottom:12px;
  border-radius:10px;
  border:1px solid #ccc;
}
button{
  background:linear-gradient(135deg,#ff9800,#f57c00);
  color:#fff;
  border:none;
  cursor:pointer;
}
button:disabled{background:#ccc}
h1,h2{color:#1b5e20}
</style>

<!-- ðŸ”¥ FIREBASE INIT (MODULE ONLY) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getAuth,
    RecaptchaVerifier,
    signInWithPhoneNumber
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBTTjddm0vLJy2-aUssX1bcI6F01Sihcy8",
    authDomain: "examroom-49900.firebaseapp.com",
    projectId: "examroom-49900",
    messagingSenderId: "378761020986",
    appId: "1:378761020986:web:b0b85863f5df0e63475703"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // expose ONLY what is needed
  window.firebaseAuth = auth;
  window.RecaptchaVerifier = RecaptchaVerifier;
  window.signInWithPhoneNumber = signInWithPhoneNumber;
</script>
</head>

<body>

<div class="container">

<!-- FORM -->
<div id="formScreen">
  <h1>Admission Form</h1>

  <input type="text" id="student" placeholder="Student Name" required>
  <input type="text" id="parent" placeholder="Parent Name" required>
  <input type="tel" id="phone" placeholder="Mobile Number" required>

  <select id="standard" required>
    <option value="">Select Standard</option>
    <option value="Std8">Std 08</option>
    <option value="Std9">Std 09</option>
    <option value="Std10">Std 10</option>
  </select>

  <select id="medium" required>
    <option value="">Select Medium</option>
    <option value="Gujarati">Gujarati Medium</option>
    <option value="English">English Medium</option>
  </select>

  <div id="recaptcha-container"></div>

  <button id="sendOtp">Send OTP</button>
  <p id="msg"></p>
</div>

<!-- OTP -->
<div id="otpScreen" class="hidden">
  <h2>Verify OTP</h2>
  <input type="number" id="otp" placeholder="Enter OTP">
  <button id="verifyOtp">Verify</button>
  <p id="otpMsg"></p>
</div>

<!-- CONFIRM -->
<div id="confirmScreen" class="hidden">
  <h2>Admission Confirmed</h2>
  <button id="confirm">Join WhatsApp Group</button>
</div>

</div>

<!-- ðŸ”¥ NORMAL JS (NO MODULE) -->
<script>
let confirmationResult;
let submitted=false;

/* medium logic */
standard.onchange=()=>{
  medium.value="";
  if(standard.value==="Std8"){
    medium.querySelector('[value="English"]').style.display="block";
  }else{
    medium.querySelector('[value="English"]').style.display="none";
    medium.value="Gujarati";
  }
};

/* reCAPTCHA init â€” THIS FIXES auth/argument-error */
window.addEventListener("load",()=>{
  window.recaptchaVerifier = new window.RecaptchaVerifier(
    "recaptcha-container",
    { size:"invisible" },
    window.firebaseAuth
  );
  window.recaptchaVerifier.render();
});

/* SEND OTP */
sendOtp.onclick=()=>{
  msg.textContent="";
  if(phone.value.length!==10){
    msg.textContent="Enter valid 10-digit number";
    return;
  }

  const fullPhone="+91"+phone.value;

  window.signInWithPhoneNumber(
    window.firebaseAuth,
    fullPhone,
    window.recaptchaVerifier
  ).then(res=>{
    confirmationResult=res;
    formScreen.classList.add("hidden");
    otpScreen.classList.remove("hidden");
  }).catch(e=>{
    msg.textContent=e.message;
  });
};

/* VERIFY OTP */
verifyOtp.onclick=()=>{
  confirmationResult.confirm(otp.value)
  .then(()=>{
    otpScreen.classList.add("hidden");
    confirmScreen.classList.remove("hidden");
  })
  .catch(()=>{
    otpMsg.textContent="Invalid OTP";
  });
};

/* FINAL CONFIRM */
confirm.onclick=()=>{
  if(submitted) return;
  submitted=true;

  const data=new FormData();
  data.append("entry.111111",student.value);
  data.append("entry.222222",parent.value);
  data.append("entry.333333",phone.value);
  data.append("entry.444444",standard.value);
  data.append("entry.555555",medium.value);

  fetch("https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse",{
    method:"POST",
    mode:"no-cors",
    body:data
  });

  let link="";
  if(standard.value==="Std8") link="https://chat.whatsapp.com/STD8_LINK";
  else if(standard.value==="Std9") link="https://chat.whatsapp.com/STD9_LINK";
  else link="https://chat.whatsapp.com/STD10_LINK";

  setTimeout(()=>location.href=link,1200);
};
</script>

</body>
</html>
